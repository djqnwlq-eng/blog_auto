import { ContentRatio, ProductConnection } from '@/types';

const CONTENT_RATIO_LABELS: Record<ContentRatio, string> = {
  experience: '경험 중심 (70% 경험 + 30% 정보)',
  'experience-rec': '경험 + 추천 (60% 경험 + 40% 정보/추천)',
  balanced: '균형형 (50% 경험 + 50% 정보)',
  info: '정보 중심 (30% 경험 + 70% 정보)',
  'pure-info': '순수 정보글 (100% 정보)',
};

const PRODUCT_CONNECTION_LABELS: Record<ProductConnection, string> = {
  ingredient: '제품의 주요 성분을 근거로 논리적으로 설명하며 소개',
  diary: '일자별 사용 후기를 상세하게 공유하며 소개',
  mixed: '주요 성분 논리적 설명 + 일자별 사용 후기를 함께 활용',
  none: '제품 언급 없이 정보글만',
};

export function buildTitlePrompt(params: {
  keyword: string;
  subKeywords: string[];
  productInfo: string;
  persona: string;
  contentRatio: ContentRatio;
  productConnection: ProductConnection;
}): string {
  return `당신은 네이버 블로그 SEO 전문가이자 카피라이터입니다.
다음 정보를 바탕으로 블로그 제목 3개를 생성해주세요.

키워드: ${params.keyword}
서브키워드: ${params.subKeywords.join(', ')}
글쓴이 페르소나: ${params.persona}
글 구성: ${CONTENT_RATIO_LABELS[params.contentRatio]}
제품 연결 방식: ${PRODUCT_CONNECTION_LABELS[params.productConnection]}
참고할 상품 정보 (제목에 직접 사용하지 말 것): ${params.productInfo}

===== 핵심 규칙 =====

1. 제목에 메인 키워드 "${params.keyword}"가 반드시 포함되어야 합니다 (필수)
2. 해당 키워드를 검색하는 사람이 실제로 무엇을 알고 싶어하는지 파악하고, 그 의도에 정확히 부합하는 제목을 만들 것
3. 제목에 제품명이나 브랜드명을 절대 포함하지 마세요
4. 25자 내외
5. 페르소나의 관점과 글 구성 방식에 맞는 톤

===== 제목 유형 (3개를 각각 다른 유형으로 생성) =====

| 유형 | 설명 | 예시 패턴 |
|------|------|-----------|
| 궁금형 | 호기심을 자극하여 클릭 유도 | "~일까?", "~알고 계셨나요?" |
| 분석형 | 정보의 깊이와 전문성 어필 | "~ 완벽 분석", "~ 비교 총정리" |
| 해결형 | 문제 해결·실용 가치 강조 | "~ 해결법 3가지", "~ 이렇게 하면 됩니다" |
| 리스트형 | 숫자로 구체성과 가독성 전달 | "~ BEST 7", "~ 추천 TOP 5" |
| 비교형 | 선택 고민을 해소해주는 비교 | "A vs B, 뭐가 더 좋을까?", "~ 차이점 한눈에 정리" |
| 경험형 | 직접 해본 생생한 후기 강조 | "~ 직접 써본 솔직 후기", "~ 한 달 사용 리얼 후기" |
| 경고형 | 손실 회피 심리를 자극 | "~ 모르면 손해", "~ 실수하면 큰일 납니다" |
| 트렌드형 | 최신성·시의성 강조 | "2025 최신 ~", "요즘 뜨는 ~ 트렌드" |
| 초보형 | 진입장벽을 낮춰 유입 확대 | "~ 초보도 5분이면 끝", "처음부터 알려주는 ~" |
| 성과형 | 구체적 결과·수치로 신뢰 확보 | "~ 했더니 수익 200% 증가", "~ 로 한 달 만에 10kg 감량" |

위 유형 중에서 키워드 "${params.keyword}"의 검색 의도와 페르소나에 가장 적합한 유형 3가지를 선택하여, 각각 다른 유형으로 제목을 1개씩 총 3개 생성하세요.

JSON 형식으로만 출력 (다른 텍스트 없이):
{"titles": ["[유형명] 제목1", "[유형명] 제목2", "[유형명] 제목3"]}`;
}

export function buildSubtitlePrompt(params: {
  keyword: string;
  subKeywords: string[];
  persona: string;
  contentRatio: ContentRatio;
  productConnection: ProductConnection;
  title: string;
}): string {
  return `너는 블로그 SEO 구조 설계 전문가야. 내가 메인 키워드와 서브 키워드를 제공하면, 검색자의 의도를 분석하여 블로그 글의 소제목 구성을 만들어줘.

===== 입력 정보 =====
메인 키워드: ${params.keyword}
서브키워드: ${params.subKeywords.join(', ')}
페르소나: ${params.persona}
글 구성: ${CONTENT_RATIO_LABELS[params.contentRatio]}
제품 연결 방식: ${PRODUCT_CONNECTION_LABELS[params.productConnection]}
선택된 제목: ${params.title}

===== 핵심 원칙: 검색 의도 기반 논리 흐름 =====

소제목은 반드시 아래 4단계 사고 흐름을 따를 것:

| 단계 | 역할 | 검색자의 속마음 |
|------|------|----------------|
| 소제목 1 — 원인/원리 | 왜 이런 문제가 생기는지 설명 | "왜 이러는 거지?" |
| 소제목 2 — 올바른 방법 | 검색한 방법의 정확한 절차·순서 제시 | "그래서 어떻게 하는 건데?" |
| 소제목 3 — 핵심 해결책 | 효과를 높이는 구체적 방법·성분·원리 | "뭘 써야 더 빨라?" |
| 소제목 4 — 실행/제품 연결 | 선택 기준 제시 + 자사 제품 자연 연결 | "구체적으로 뭘 사면 돼?" |

이 흐름은 원인 → 방법 → 심화 → 실행의 구조로, 검색자가 글을 끝까지 읽게 만들고 마지막에 제품 전환이 자연스럽게 이루어지도록 설계된 것이다.

===== 소제목 작성 규칙 =====
- 소제목은 반드시 4개로 구성할 것
- 각 소제목은 이전 소제목의 내용을 기반으로 자연스럽게 이어질 것 (논리적 연결)
- 소제목 유형을 다양하게 혼합할 것 (질문형만 반복 금지):
  - 질문형: "~일까?"
  - 정보형: "~ 정리", "~ 가이드"
  - 행동형: "~ 하는 법", "~ 이렇게 하세요"
  - 비교형: "A vs B, ~"
- 서브 키워드를 소제목 2 또는 3에 자연스럽게 포함할 것
- 소제목 4는 제품 연결이 가능한 방향으로 설계하되, 제품명을 직접 넣지 않을 것 (유동적 가능)
- 15자 내외의 간결한 문구
- 선택된 제목 및 페르소나의 관점에 맞는 톤

JSON 형식으로만 출력 (다른 텍스트 없이):
{"subtitles": ["소제목1", "소제목2", "소제목3", "소제목4"]}`;
}

export function buildPersonaPrompt(keyword: string): string {
  return `당신은 블로그 마케팅 전문가입니다.
다음 키워드를 검색하는 사람들의 페르소나를 분석해주세요.

키워드: ${keyword}

이 키워드를 검색하는 사람은 어떤 상황에 있을까요?
검색 의도를 분석하여 가장 적합한 글쓴이 페르소나 4개를 생성해주세요.

조건:
- 각 페르소나는 구체적인 상황과 감정이 담겨야 합니다
- 키워드의 검색 의도에 맞는 현실적인 인물 설정
- 일반적이거나 뻔한 설정은 피하세요
- 각 페르소나는 서로 다른 관점이어야 합니다

JSON 형식으로만 출력 (다른 텍스트 없이):
{"personas": ["페르소나1", "페르소나2", "페르소나3", "페르소나4"]}`;
}

export function buildContentPrompt(params: {
  title: string;
  keyword: string;
  subKeywords: string[];
  persona: string;
  contentRatio: ContentRatio;
  productConnection: ProductConnection;
  productInfo: string;
  sellingPoints: string[];
  subtitles: string[];
}): string {
  const subtitleList = params.subtitles.length > 0
    ? params.subtitles.map((s, i) => `소제목 ${i + 1}: ${s}`).join('\n')
    : '';

  const productConnectionRule = params.productConnection === 'ingredient'
    ? `- 제품의 주요 성분(예: 유효 성분, 특허 성분 등)을 근거로 왜 효과가 있는지 논리적으로 설명
- 성분 관련 근거는 글 전체에서 1~2회만 자연스럽게 제시`
    : params.productConnection === 'diary'
    ? `- 1일차, 3일차, 7일차 등 일자별 사용 경험을 구체적으로 서술
- 각 일자별로 느낀 변화와 감정을 생생하게 묘사`
    : params.productConnection === 'mixed'
    ? `- 성분에 대한 논리적 설명과 일자별 사용 후기를 자연스럽게 섞어서 구성
- 성분 근거 1~2회 + 일자별 변화 묘사를 조합`
    : '- 제품 언급 없이 순수 정보와 경험만으로 구성';

  return `너는 2026년 네이버 및 AI 추천 알고리즘에 최적화된 경험 기반 스토리형 블로그 글쓰기 전문가다.

아래 입력 정보를 바탕으로 최소 1800자 ~ 2200자 내외의 추천형 블로그 글을 작성하라.
정보 나열이 아니라 실제로 내가 직접 겪은 경험처럼 감정과 행동을 묘사하여 읽는 사람이 끝까지 머무르게 만드는 글을 작성해야 한다.

===== 입력 정보 =====
- 제목: ${params.title}
- 키워드: ${params.keyword}
- 서브키워드: ${params.subKeywords.join(', ')}
- 페르소나: ${params.persona}
- 글 구성: ${CONTENT_RATIO_LABELS[params.contentRatio]}
- 제품 연결 방식: ${PRODUCT_CONNECTION_LABELS[params.productConnection]}
- 상품 정보: ${params.productInfo}
- 셀링포인트: ${params.sellingPoints.join(', ')}

===== 소제목 구성 =====
${subtitleList}

===== 키워드 규칙 =====
- 글 제목에 사용된 핵심 키워드 "${params.keyword}"는 본문에서 최소 3회 이상 자연스럽게 언급
- 서브키워드(${params.subKeywords.join(', ')})는 각각 1회 이상 자연스럽게 포함
- 억지 반복 금지, 문맥 속에서 의미 있게 녹여 사용

===== 소제목 활용 규칙 =====
소제목은 질문형이므로, 각 소제목 아래 본문은 해당 질문에 대한 답변으로 자연스럽게 시작할 것.
단, 매번 같은 패턴으로 시작하지 말 것. 아래처럼 다양한 방식을 섞어서 사용:
- 결론을 먼저 제시하는 방식 (4개 소제목 중 최대 1회만 허용): "결론부터 말씀드리면, ~"
- 경험으로 시작하는 방식: "제가 직접 겪어보니 ~", "처음에 저도 이게 궁금했는데요 ~"
- 상황 묘사로 시작하는 방식: "그때 당시 ~", "막상 해보니까 ~"
- 공감으로 시작하는 방식: "이 부분 정말 많이들 궁금해하시더라고요 ~"
- 핵심 정보로 바로 들어가는 방식: 별도 서두 없이 바로 내용 전개

중요: "결론부터 말씀드리면"은 글 전체에서 최대 1번만 사용 가능. 소제목마다 반복 절대 금지.
비슷한 표현 반복 금지. 번호·특수기호 없이 자연스러운 문장으로 작성.

===== 글 구조 — 기승전결 =====

[기] 도입부 — 공감 + 결과 + 희망
- 공감 → 힘들었던 상황 → 현재 달라진 결과 → 공유 의도 순서
- 감정 단어(막막/걱정/불안/지침/안도/희망) 중 1개 이상 포함
- 도입 패턴 (변형 사용):
  "○○ 때문에 ○개월 동안 정말 힘들었습니다.
  여러 방법을 시도했지만 뚜렷한 답이 없어 막막했어요.
  그런데 지금은 상황이 꽤 달라졌습니다.
  제가 어떤 과정을 거쳤는지 공유해보려 합니다."
- 도입부에는 제품명 절대 언급 금지
- 도입부 끝에 반드시 사진 가이드 삽입:
  [사진: 페르소나의 고민 상황을 보여주는 이미지]

[승] 원인 파트 — 경험 속에서 원인 깨달음 (소제목 1 아래 배치)
- 딱딱한 정보 나열 금지, 직접 겪으며 원인을 이해한 흐름
- 필수 포함 패턴:
  "처음엔 원인을 몰라서 ○○을 해봤습니다."
  "그때는 정말 막막했어요."
  "알고 보니 ○○이 문제였습니다."
- 원인 최소 2가지 이상:
  "첫 번째 원인은 ○○였습니다."
  "두 번째로는 ○○이 영향을 줬습니다."
- 원인 설명 후 반드시 사진 가이드 삽입:
  [사진: 원인이나 문제 상황을 설명하는 이미지]

[전] 전환점 파트 — 시행착오와 선택 과정 (소제목 2 아래 배치)
- 시도한 방법 최소 2개 이상, 실제 행동 묘사 필수
- 필수 문장 패턴 중 2개 이상 포함:
  "이 방법도 시도해봤지만 ○○해서 포기했습니다."
  "병원을 방문했는데 선생님께서는 ○○을 권하셨습니다."
  "비용과 부작용이 걱정됐습니다."
  "후기를 찾아보며 밤늦게까지 비교했습니다."
- 제가/직접/걱정/비교/밤늦게 표현 포함
- 시행착오 묘사 후 반드시 사진 가이드 삽입:
  [사진: 여러 방법을 비교하거나 시도하는 과정 이미지]

[결] 해결 + 변화 파트 (소제목 3 아래 배치)
- 해결 방법 또는 제품 제시
- 처음 사용 → 느낀 변화 → 지속 이유 순서
- 필수 포함: Before → After 감정 변화, 생활 변화 묘사
- 문장 패턴:
  "예전엔 ○○해서 불안했지만, 지금은 마음이 편합니다."
  "이제는 ○○이 달라졌습니다."
  "일상에서도 ○○이 훨씬 수월해졌습니다."
- 제품/해결책 소개 후 반드시 사진 가이드 삽입:
  [사진: 제품 제형이 잘 보이는 이미지] 또는 [사진: 사용 전후 비교 이미지]

독자 대입 + 최종 정리 (소제목 4 아래 배치)
- 필수 문단:
  "혹시 지금 ○○ 때문에 거울 볼 때마다 신경 쓰이는 분들,
  ○○ 때문에 사람 만나는 게 불편한 분들이라면
  저처럼 원인부터 천천히 점검해보시길 권해드립니다."
- 마지막은 따라할 수 있는 정리형 결론으로 마무리
- 마무리 후 반드시 사진 가이드 삽입:
  [사진: 긍정적인 변화나 현재 상태를 보여주는 이미지]

===== 감정 서술 강제 규칙 =====
각 파트마다 감정 단어 최소 1회 포함: 막막/걱정/불안/지침/안도/희망

===== 경험 서술 강제 규칙 =====
모든 정보 문장은 경험형으로 변환할 것.
X "○○이 효과적입니다." → O "제가 ○○을 직접 해보니 ○○한 변화가 느껴졌습니다."
X "○○ 관리가 중요합니다." → O "처음엔 몰랐는데, 직접 겪어보니 관리가 필요하더라고요."
반드시 "제가/직접/처음엔/나중엔" 중 1개 이상 포함.

===== 근거 + 신뢰 확장 규칙 =====
- 근거 제시는 전체 글에서 1~2회만, 최소·정확·자연스럽게
- 내 제품 또는 해결 방법과 연결 가능한 근거 1개면 충분
- 과도한 논문 설명 금지
- 예시: "식약처 자료에 따르면 ○○ 관리에는 ○○ 방식이 효과적이라고 언급되어 있습니다."
- 논문 형식: 출처: [논문 제목, 학회명, 연도]
- 정확한 논문이 없으면: (여기에 관련 논문 제목을 넣어주세요) 라고 표기

===== 제품 연결 규칙 =====
${productConnectionRule}

===== 문체 규칙 =====
- 문장 끝맺음은 섞어서 사용: ~요 / ~죠 / ~습니다 / ~다
- 같은 어투 연속 반복 금지
- 실제 사람 말투처럼 자연스럽게

===== 사진 가이드 (필수) =====
반드시 각 파트마다 1개씩, 전체 글에서 최소 5개의 [사진: 설명] 가이드를 삽입할 것.
각 사진 가이드는 독립된 줄에 작성하고, 해당 파트의 내용과 관련된 구체적인 설명을 포함.
예: [사진: 제품 제형이 잘 보이는 클로즈업 이미지]
예: [사진: 사용 전후 피부 변화 비교 이미지]
예: [사진: 고민하는 모습이나 일상 속 불편함을 보여주는 이미지]

===== 최종 출력 조건 =====
- 전체 분량 1800~2200자 내외
- 키워드 최소 3회 이상 자연스럽게
- 롱테일 소제목 4개 포함
- 기승전결 구조 유지
- 감정·경험·시행착오·근거·독자대입 필수
- 체류·완독 유도형 서사

마크다운 형식으로 출력해주세요.`;
}

export function buildSubKeywordPrompt(keyword: string): string {
  return `당신은 네이버 블로그 SEO 전문가입니다.
다음 메인 키워드에 대한 연관 서브 키워드 5개를 추천해주세요.

메인 키워드: ${keyword}

조건:
- 실제 사용자들이 검색할 만한 키워드
- 메인 키워드와 관련성이 높은 키워드
- 롱테일 키워드 포함

JSON 형식으로만 출력 (다른 텍스트 없이):
{"keywords": ["키워드1", "키워드2", "키워드3", "키워드4", "키워드5"]}`;
}

export function buildThreadPrompt(blogContent: string): string {
  return `너는 스레드(Threads) 콘텐츠 전문 마케터야. 내가 블로그 글을 제공하면, 아래 규칙에 따라 브랜드 공식 계정용 스레드 게시물로 변환해줘.

[원문 블로그 글]
${blogContent}

[변환 구조]
모든 게시물은 아래 3단 구조로 작성할 것:

① 본문 (훅 + 정보 예고)
- 첫 문장: 타겟의 고민·상황을 정확히 짚는 훅 (공감형/문제제기형)
- 두 번째 문장: 브랜드 전문가 포지션 확립 (예: "비비오덤이 정리해드릴게요")
- 마지막 문장: 댓글로 유도하는 CTA + 👇 이모지
- 분량: 3~4문장 이내

② 첫 번째 댓글 (순수 정보 제공)
- 블로그 글의 핵심 정보를 스레드에 맞게 압축
- 번호(①②③④) 사용하여 가독성 확보
- 전문 용어는 쉽게 풀어서 설명
- 이 댓글에는 제품 홍보를 절대 넣지 않을 것
- 분량: 4~5항목

③ 두 번째 댓글 (자연스러운 제품 연결)
- 첫 번째 댓글의 정보를 기반으로 자사 제품을 연결 (예: "비비오덤은 이 원리를 기반으로 설계된 ~입니다")
- 원리·설계 의도 중심으로 설명 (기능 나열 금지)
- 마지막에 행동 유도 1가지 (프로필 링크 안내 / 후기 확인 유도 / 질문 유도 중 택 1)
- 분량: 2~3문장

[톤 & 스타일 규칙]
- 말투: 친근하지만 전문가다운 ("~해요" 체, 존댓말 기반 부드러운 톤)
- 절대 하지 말 것:
  - 후기인 척하는 위장 톤 ("나는 써봤는데~" 금지)
  - 과장된 효과 단정 ("3일 만에 완치" 금지)
  - 경쟁 제품 비하
  - 본문에서 직접적 제품 홍보
- 반드시 할 것:
  - 본문 첫 문장에서 타겟 특정 (누구를 위한 글인지 명확히)
  - 정보와 홍보의 물리적 분리 (댓글 단위로 구분)
  - 의학적 정보는 정확하게 (잘못된 순서·방법 금지)

[Output Format]
반드시 아래 JSON 형식으로만 출력 (다른 텍스트 없이):
{
  "main": "본문 (훅 + 정보 예고 + CTA)",
  "comments": ["첫 번째 댓글 (순수 정보 제공)", "두 번째 댓글 (자연스러운 제품 연결)"]
}`;
}

export function buildUrlAnalysisPrompt(pageContent: string): string {
  return `다음은 상품 상세페이지의 내용입니다. 이 상품의 핵심 셀링포인트를 추출해주세요.

페이지 내용:
${pageContent}

조건:
- 주요 셀링포인트를 5-8개 추출
- 각 셀링포인트는 간결하게 한 문장으로
- 소비자 관점에서 매력적인 포인트 위주

JSON 형식으로만 출력 (다른 텍스트 없이):
{"summary": "상품 요약 설명", "sellingPoints": ["포인트1", "포인트2", ...]}`;
}
