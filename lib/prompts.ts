import { ContentRatio, ProductConnection } from '@/types';

const CONTENT_RATIO_LABELS: Record<ContentRatio, string> = {
  experience: '경험 중심 (70% 경험 + 30% 정보)',
  'experience-rec': '경험 + 추천 (60% 경험 + 40% 정보/추천)',
  balanced: '균형형 (50% 경험 + 50% 정보)',
  info: '정보 중심 (30% 경험 + 70% 정보)',
  'pure-info': '순수 정보글 (100% 정보)',
};

const PRODUCT_CONNECTION_LABELS: Record<ProductConnection, string> = {
  ingredient: '제품의 주요 성분을 근거로 논리적으로 설명하며 소개',
  diary: '일자별 사용 후기를 상세하게 공유하며 소개',
  mixed: '주요 성분 논리적 설명 + 일자별 사용 후기를 함께 활용',
  none: '제품 언급 없이 정보글만',
};

export function buildTitlePrompt(params: {
  keyword: string;
  subKeywords: string[];
  productInfo: string;
  persona: string;
  contentRatio: ContentRatio;
  productConnection: ProductConnection;
}): string {
  return `당신은 네이버 블로그 SEO 전문가이자 카피라이터입니다.
다음 정보를 바탕으로 클릭을 유도하는 블로그 제목 3개를 생성해주세요.

키워드: ${params.keyword}
서브키워드: ${params.subKeywords.join(', ')}
글쓴이 페르소나: ${params.persona}
글 구성: ${CONTENT_RATIO_LABELS[params.contentRatio]}
제품 연결 방식: ${PRODUCT_CONNECTION_LABELS[params.productConnection]}

절대 지켜야 할 규칙:
- 제목에 제품명이나 브랜드명을 절대 포함하지 마세요
- 검색자가 클릭하고 싶어지는 강력한 훅이 있어야 합니다
- 궁금증 유발, 충격적 사실, 의외의 정보, 경고성 문구 등 활용
- 페르소나의 관점과 글 구성 방식에 맞는 톤의 제목
- 25자 내외
- 숫자나 구체적 표현 포함
- 검색 의도에 정확히 부합하는 제목

참고할 상품 정보 (제목에 직접 사용하지 말 것): ${params.productInfo}

좋은 제목 예시:
- "이것 모르고 바르면 오히려 악화됩니다"
- "피부과 의사가 절대 안 쓰는 3가지"
- "3일 만에 효과 본 방법 공개합니다"

JSON 형식으로만 출력 (다른 텍스트 없이):
{"titles": ["제목1", "제목2", "제목3"]}`;
}

export function buildSubtitlePrompt(params: {
  keyword: string;
  subKeywords: string[];
  persona: string;
  contentRatio: ContentRatio;
  productConnection: ProductConnection;
  title: string;
}): string {
  return `당신은 네이버 블로그 SEO 전문가이자, 경험 기반 스토리형 블로그 구성 전문가입니다.

===== 입력 정보 =====
주제(키워드): ${params.keyword}
페르소나: ${params.persona}
글 구성: ${CONTENT_RATIO_LABELS[params.contentRatio]}
제품 연결 방식: ${PRODUCT_CONNECTION_LABELS[params.productConnection]}
선택된 제목: ${params.title}
서브키워드: ${params.subKeywords.join(', ')}

===== 요청 =====
위 정보를 바탕으로 '질문형 롱테일 키워드' 소제목 4개를 생성해주세요.
이 소제목은 본문의 기승전결 구조에서 각각 다음 역할을 담당합니다:

소제목 1 = [승] 원인 파트
→ 페르소나가 직접 겪으며 원인을 깨달아가는 내용
→ "왜 이런 문제가 생기는 걸까?", "원인이 뭐였을까?" 방향의 질문
→ 검색자의 불안함이나 궁금증을 자극하는 질문

소제목 2 = [전] 전환점 파트
→ 시행착오와 여러 방법을 비교·선택하는 과정
→ "어떤 방법이 효과적일까?", "뭘 먼저 해봐야 할까?" 방향의 질문
→ 해결책을 찾아가는 과정에 대한 궁금증 유발

소제목 3 = [결] 해결 + 변화 파트
→ 실제 해결 방법을 적용하고 변화를 느낀 경험
→ "실제로 효과가 있었을까?", "얼마나 달라졌을까?" 방향의 질문
→ Before/After 변화에 대한 기대감 유발

소제목 4 = 독자 대입 + 최종 정리
→ 같은 고민을 가진 독자에게 직접 말을 거는 정리
→ "나도 해볼 수 있을까?", "주의할 점은 없을까?" 방향의 질문
→ 독자가 자신의 상황에 대입할 수 있는 질문

===== 소제목 작성 규칙 =====
- 사람들이 실제로 네이버나 구글에 검색할 법한 자연스러운 질문형
- 15자 내외의 질문 형태 ('방법', '이유', '시기', '주의사항', '효과' 등 포함)
- 단순 단어 나열이 아닌, 대화하듯 자연스러운 문구
- 선택된 제목 및 페르소나의 관점에 맞는 톤
- 서브키워드를 자연스럽게 반영
- 4개의 소제목이 기승전결 흐름으로 자연스럽게 이어질 것

JSON 형식으로만 출력 (다른 텍스트 없이):
{"subtitles": ["소제목1", "소제목2", "소제목3", "소제목4"]}`;
}

export function buildPersonaPrompt(keyword: string): string {
  return `당신은 블로그 마케팅 전문가입니다.
다음 키워드를 검색하는 사람들의 페르소나를 분석해주세요.

키워드: ${keyword}

이 키워드를 검색하는 사람은 어떤 상황에 있을까요?
검색 의도를 분석하여 가장 적합한 글쓴이 페르소나 4개를 생성해주세요.

조건:
- 각 페르소나는 구체적인 상황과 감정이 담겨야 합니다
- 키워드의 검색 의도에 맞는 현실적인 인물 설정
- 일반적이거나 뻔한 설정은 피하세요
- 각 페르소나는 서로 다른 관점이어야 합니다

JSON 형식으로만 출력 (다른 텍스트 없이):
{"personas": ["페르소나1", "페르소나2", "페르소나3", "페르소나4"]}`;
}

export function buildContentPrompt(params: {
  title: string;
  keyword: string;
  subKeywords: string[];
  persona: string;
  contentRatio: ContentRatio;
  productConnection: ProductConnection;
  productInfo: string;
  sellingPoints: string[];
  subtitles: string[];
}): string {
  const subtitleList = params.subtitles.length > 0
    ? params.subtitles.map((s, i) => `소제목 ${i + 1}: ${s}`).join('\n')
    : '';

  const productConnectionRule = params.productConnection === 'ingredient'
    ? `- 제품의 주요 성분(예: 유효 성분, 특허 성분 등)을 근거로 왜 효과가 있는지 논리적으로 설명
- 성분 관련 근거는 글 전체에서 1~2회만 자연스럽게 제시`
    : params.productConnection === 'diary'
    ? `- 1일차, 3일차, 7일차 등 일자별 사용 경험을 구체적으로 서술
- 각 일자별로 느낀 변화와 감정을 생생하게 묘사`
    : params.productConnection === 'mixed'
    ? `- 성분에 대한 논리적 설명과 일자별 사용 후기를 자연스럽게 섞어서 구성
- 성분 근거 1~2회 + 일자별 변화 묘사를 조합`
    : '- 제품 언급 없이 순수 정보와 경험만으로 구성';

  return `너는 2026년 네이버 및 AI 추천 알고리즘에 최적화된 경험 기반 스토리형 블로그 글쓰기 전문가다.

아래 입력 정보를 바탕으로 최소 1800자 ~ 2200자 내외의 추천형 블로그 글을 작성하라.
정보 나열이 아니라 실제로 내가 직접 겪은 경험처럼 감정과 행동을 묘사하여 읽는 사람이 끝까지 머무르게 만드는 글을 작성해야 한다.

===== 입력 정보 =====
- 제목: ${params.title}
- 키워드: ${params.keyword}
- 서브키워드: ${params.subKeywords.join(', ')}
- 페르소나: ${params.persona}
- 글 구성: ${CONTENT_RATIO_LABELS[params.contentRatio]}
- 제품 연결 방식: ${PRODUCT_CONNECTION_LABELS[params.productConnection]}
- 상품 정보: ${params.productInfo}
- 셀링포인트: ${params.sellingPoints.join(', ')}

===== 소제목 구성 =====
${subtitleList}

===== 키워드 규칙 =====
- 글 제목에 사용된 핵심 키워드 "${params.keyword}"는 본문에서 최소 3회 이상 자연스럽게 언급
- 서브키워드(${params.subKeywords.join(', ')})는 각각 1회 이상 자연스럽게 포함
- 억지 반복 금지, 문맥 속에서 의미 있게 녹여 사용

===== 소제목 활용 규칙 =====
소제목은 질문형이므로, 그 바로 아래 본문 첫 문장은 결론부터 직관적으로 제시할 것.
예시) 소제목: "입술 헤르페스 전염, 컵 같이 쓰면 무조건 옮나요?"
→ 본문 첫 문장: "결론부터 말씀드리면, 수건이나 컵을 공유하는 것만으로도 충분히 전염될 수 있으므로 물집이 잡힌 기간에는 반드시 개인 물품을 따로 사용해야 합니다."

비슷한 표현 반복 금지. 번호·특수기호 없이 자연스러운 문장으로 작성.

===== 글 구조 — 기승전결 =====

[기] 도입부 — 공감 + 결과 + 희망
- 공감 → 힘들었던 상황 → 현재 달라진 결과 → 공유 의도 순서
- 감정 단어(막막/걱정/불안/지침/안도/희망) 중 1개 이상 포함
- 도입 패턴 (변형 사용):
  "○○ 때문에 ○개월 동안 정말 힘들었습니다.
  여러 방법을 시도했지만 뚜렷한 답이 없어 막막했어요.
  그런데 지금은 상황이 꽤 달라졌습니다.
  제가 어떤 과정을 거쳤는지 공유해보려 합니다."
- 도입부에는 제품명 절대 언급 금지
- 도입부 끝에 반드시 사진 가이드 삽입:
  [사진: 페르소나의 고민 상황을 보여주는 이미지]

[승] 원인 파트 — 경험 속에서 원인 깨달음 (소제목 1 아래 배치)
- 딱딱한 정보 나열 금지, 직접 겪으며 원인을 이해한 흐름
- 필수 포함 패턴:
  "처음엔 원인을 몰라서 ○○을 해봤습니다."
  "그때는 정말 막막했어요."
  "알고 보니 ○○이 문제였습니다."
- 원인 최소 2가지 이상:
  "첫 번째 원인은 ○○였습니다."
  "두 번째로는 ○○이 영향을 줬습니다."
- 원인 설명 후 반드시 사진 가이드 삽입:
  [사진: 원인이나 문제 상황을 설명하는 이미지]

[전] 전환점 파트 — 시행착오와 선택 과정 (소제목 2 아래 배치)
- 시도한 방법 최소 2개 이상, 실제 행동 묘사 필수
- 필수 문장 패턴 중 2개 이상 포함:
  "이 방법도 시도해봤지만 ○○해서 포기했습니다."
  "병원을 방문했는데 선생님께서는 ○○을 권하셨습니다."
  "비용과 부작용이 걱정됐습니다."
  "후기를 찾아보며 밤늦게까지 비교했습니다."
- 제가/직접/걱정/비교/밤늦게 표현 포함
- 시행착오 묘사 후 반드시 사진 가이드 삽입:
  [사진: 여러 방법을 비교하거나 시도하는 과정 이미지]

[결] 해결 + 변화 파트 (소제목 3 아래 배치)
- 해결 방법 또는 제품 제시
- 처음 사용 → 느낀 변화 → 지속 이유 순서
- 필수 포함: Before → After 감정 변화, 생활 변화 묘사
- 문장 패턴:
  "예전엔 ○○해서 불안했지만, 지금은 마음이 편합니다."
  "이제는 ○○이 달라졌습니다."
  "일상에서도 ○○이 훨씬 수월해졌습니다."
- 제품/해결책 소개 후 반드시 사진 가이드 삽입:
  [사진: 제품 제형이 잘 보이는 이미지] 또는 [사진: 사용 전후 비교 이미지]

독자 대입 + 최종 정리 (소제목 4 아래 배치)
- 필수 문단:
  "혹시 지금 ○○ 때문에 거울 볼 때마다 신경 쓰이는 분들,
  ○○ 때문에 사람 만나는 게 불편한 분들이라면
  저처럼 원인부터 천천히 점검해보시길 권해드립니다."
- 마지막은 따라할 수 있는 정리형 결론으로 마무리
- 마무리 후 반드시 사진 가이드 삽입:
  [사진: 긍정적인 변화나 현재 상태를 보여주는 이미지]

===== 감정 서술 강제 규칙 =====
각 파트마다 감정 단어 최소 1회 포함: 막막/걱정/불안/지침/안도/희망

===== 경험 서술 강제 규칙 =====
모든 정보 문장은 경험형으로 변환할 것.
X "○○이 효과적입니다." → O "제가 ○○을 직접 해보니 ○○한 변화가 느껴졌습니다."
X "○○ 관리가 중요합니다." → O "처음엔 몰랐는데, 직접 겪어보니 관리가 필요하더라고요."
반드시 "제가/직접/처음엔/나중엔" 중 1개 이상 포함.

===== 근거 + 신뢰 확장 규칙 =====
- 근거 제시는 전체 글에서 1~2회만, 최소·정확·자연스럽게
- 내 제품 또는 해결 방법과 연결 가능한 근거 1개면 충분
- 과도한 논문 설명 금지
- 예시: "식약처 자료에 따르면 ○○ 관리에는 ○○ 방식이 효과적이라고 언급되어 있습니다."
- 논문 형식: 출처: [논문 제목, 학회명, 연도]
- 정확한 논문이 없으면: (여기에 관련 논문 제목을 넣어주세요) 라고 표기

===== 제품 연결 규칙 =====
${productConnectionRule}

===== 문체 규칙 =====
- 문장 끝맺음은 섞어서 사용: ~요 / ~죠 / ~습니다 / ~다
- 같은 어투 연속 반복 금지
- 실제 사람 말투처럼 자연스럽게

===== 사진 가이드 (필수) =====
반드시 각 파트마다 1개씩, 전체 글에서 최소 5개의 [사진: 설명] 가이드를 삽입할 것.
각 사진 가이드는 독립된 줄에 작성하고, 해당 파트의 내용과 관련된 구체적인 설명을 포함.
예: [사진: 제품 제형이 잘 보이는 클로즈업 이미지]
예: [사진: 사용 전후 피부 변화 비교 이미지]
예: [사진: 고민하는 모습이나 일상 속 불편함을 보여주는 이미지]

===== 최종 출력 조건 =====
- 전체 분량 1800~2200자 내외
- 키워드 최소 3회 이상 자연스럽게
- 롱테일 소제목 4개 포함
- 기승전결 구조 유지
- 감정·경험·시행착오·근거·독자대입 필수
- 체류·완독 유도형 서사

마크다운 형식으로 출력해주세요.`;
}

export function buildSubKeywordPrompt(keyword: string): string {
  return `당신은 네이버 블로그 SEO 전문가입니다.
다음 메인 키워드에 대한 연관 서브 키워드 5개를 추천해주세요.

메인 키워드: ${keyword}

조건:
- 실제 사용자들이 검색할 만한 키워드
- 메인 키워드와 관련성이 높은 키워드
- 롱테일 키워드 포함

JSON 형식으로만 출력 (다른 텍스트 없이):
{"keywords": ["키워드1", "키워드2", "키워드3", "키워드4", "키워드5"]}`;
}

export function buildThreadPrompt(blogContent: string): string {
  return `다음 블로그 글을 스레드(SNS) 마케팅용으로 변환해주세요.

원문:
${blogContent}

변환 규칙:
1. 반말 어투
2. 첫 줄은 강렬한 훅 (궁금증 유발)
3. 메인 글 280자 이내
4. 핵심 정보만 압축
5. 이어지는 댓글 3개 제안 (각 100자 이내)

JSON 형식으로만 출력 (다른 텍스트 없이):
{
  "main": "메인 글",
  "comments": ["댓글1", "댓글2", "댓글3"]
}`;
}

export function buildUrlAnalysisPrompt(pageContent: string): string {
  return `다음은 상품 상세페이지의 내용입니다. 이 상품의 핵심 셀링포인트를 추출해주세요.

페이지 내용:
${pageContent}

조건:
- 주요 셀링포인트를 5-8개 추출
- 각 셀링포인트는 간결하게 한 문장으로
- 소비자 관점에서 매력적인 포인트 위주

JSON 형식으로만 출력 (다른 텍스트 없이):
{"summary": "상품 요약 설명", "sellingPoints": ["포인트1", "포인트2", ...]}`;
}
